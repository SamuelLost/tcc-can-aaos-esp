<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Can2Cloud: Can2Cloud</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Can2Cloud<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">Application to send CAN messages to the cloud</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Can2Cloud </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> </p>
<h2><a class="anchor" id="autotoc_md1"></a>
Clone the repository</h2>
<div class="fragment"><div class="line">git clone --recurse-submodules git@bitbucket.org:eldoradocorp/can2cloud.git</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
Prerequisites</h1>
<ul>
<li><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/get-started/index.html#installation-step-by-step">ESP-IDF v5.1</a></li>
<li><a href="https://code.visualstudio.com/">VSCode</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Introduction</h1>
<p>Application to send data from a CAN bus to a cloud service. One ESP32 is used to read the accelerometer data and send it to the CAN bus. The other ESP32 is used to read the data from the CAN bus and send it to the cloud service through module SIM900a that uses the GPRS network.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Hardware</h1>
<ul>
<li>2 ESP32</li>
<li>2 CAN bus modules <a class="el" href="namespaceMCP2515.html" title="Namespace for MCP2515 driver.">MCP2515</a></li>
<li>1 SIM900a</li>
<li>1 Accelerometer <a class="el" href="namespaceMPU6050.html" title="A namespace for MPU6050.">MPU6050</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
Circuit diagram</h2>
<p><img src="docs/can2cloud_bb.png" alt="Circuit diagram" class="inline"/></p>
<p>The two ESP32 follow the same pinout with the <a class="el" href="namespaceMCP2515.html" title="Namespace for MCP2515 driver.">MCP2515</a> module:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"><b><a class="el" href="namespaceMCP2515.html" title="Namespace for MCP2515 driver.">MCP2515</a></b>   </th><th class="markdownTableHeadCenter"><b>ESP32</b>   </th><th class="markdownTableHeadCenter"><b>Wire</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">VCC   </td><td class="markdownTableBodyCenter">5V   </td><td class="markdownTableBodyCenter">Red    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">Black    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">CS   </td><td class="markdownTableBodyCenter">GPIO5   </td><td class="markdownTableBodyCenter">Magenta    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">MISO   </td><td class="markdownTableBodyCenter">GPIO19   </td><td class="markdownTableBodyCenter">Green    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">MOSI   </td><td class="markdownTableBodyCenter">GPIO23   </td><td class="markdownTableBodyCenter">White    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SCK   </td><td class="markdownTableBodyCenter">GPIO18   </td><td class="markdownTableBodyCenter">Orange    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">INT   </td><td class="markdownTableBodyCenter">N.C   </td><td class="markdownTableBodyCenter">No wire   </td></tr>
</table>
<p>The <a class="el" href="namespaceMPU6050.html" title="A namespace for MPU6050.">MPU6050</a> module is connected to one of the ESP32: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"><b><a class="el" href="namespaceMPU6050.html" title="A namespace for MPU6050.">MPU6050</a></b>   </th><th class="markdownTableHeadCenter"><b>ESP32</b>   </th><th class="markdownTableHeadCenter"><b>Wire</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">VCC   </td><td class="markdownTableBodyCenter">3V3   </td><td class="markdownTableBodyCenter">Red    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">Black    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SCL   </td><td class="markdownTableBodyCenter">GPIO22   </td><td class="markdownTableBodyCenter">Green    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SDA   </td><td class="markdownTableBodyCenter">GPIO21   </td><td class="markdownTableBodyCenter">Yellow   </td></tr>
</table>
<p>The SIM900a module is connected to the other ESP32: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"><b>SIM900a</b>   </th><th class="markdownTableHeadCenter"><b>ESP32</b>   </th><th class="markdownTableHeadCenter"><b>Wire</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">VCC   </td><td class="markdownTableBodyCenter">5V   </td><td class="markdownTableBodyCenter">Red    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">Black    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">TXD   </td><td class="markdownTableBodyCenter">GPIO17   </td><td class="markdownTableBodyCenter">Yellow    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">RXD   </td><td class="markdownTableBodyCenter">GPIO16   </td><td class="markdownTableBodyCenter">Grey   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md6"></a>
Software</h1>
<p>The ESP32 is programmed using the ESP-IDF framework. Two codes are used, one for each ESP32. The code <a href="main/main_receive.cpp">main_receive.cpp</a> is used to read the data from the CAN bus and send it to the cloud service. The code <a href="main/main_send.cpp">main_send.cpp</a> is used to read the data from the accelerometer and send it to the CAN bus.</p>
<p>The code <a href="main/main_receive.cpp">main_receive.cpp</a> uses the submodule <a href="components/mcp2515/">mcp2515</a> to read the data from the CAN bus and the component <a href="components/sim900a/">sim900a</a> to send the data to the cloud service. The code uses 2 tasks, one to read the data from the CAN bus and another to send the data to the cloud service. Queue is used to pass the data between the tasks and store the CAN messages.</p>
<p>The code <a href="main/main_send.cpp">main_send.cpp</a> uses the submodule <a href="components/mpu6050/">mpu6050</a> to read the data from the accelerometer and the component <a href="components/mcp2515/">mcp2515</a> to send the data to the CAN bus. The code uses 2 tasks, one to read the data from the accelerometer and another to send the data to the CAN bus. Queue is used to pass the data between the tasks and store the accelerometer data.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
How to use</h1>
<p>Modify the variable APP_VERSION in <a href="main/CMakeLists.txt">CMakeLists.txt</a> for select the code to be compiled. The code <a href="main/main_send.cpp">main_send.cpp</a> is compiled when APP_VERSION is equal to 1. The code <a href="main/main_receive.cpp">main_receive.cpp</a> is compiled when APP_VERSION is equal to 2.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Documentation</h1>
<p>The documentation of the code is generated using Doxygen. The documentation is available in the folder <a href="docs/">docs</a>.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Contributors</h3>
<p>Samuel Henrique Guimar√£es Alencar (<a href="#" onclick="location.href='mai'+'lto:'+'sam'+'ue'+'l.a'+'le'+'nca'+'r@'+'eld'+'or'+'ado'+'.o'+'rg.'+'br'; return false;">samue<span class="obfuscator">.nosp@m.</span>l.al<span class="obfuscator">.nosp@m.</span>encar<span class="obfuscator">.nosp@m.</span>@eld<span class="obfuscator">.nosp@m.</span>orado<span class="obfuscator">.nosp@m.</span>.org<span class="obfuscator">.nosp@m.</span>.br</a>)</p>
<p>Elias Frota Coutinho Filho (<a href="#" onclick="location.href='mai'+'lto:'+'eli'+'as'+'.fi'+'lh'+'o@e'+'ld'+'ora'+'do'+'.or'+'g.'+'br'; return false;">elias<span class="obfuscator">.nosp@m.</span>.fil<span class="obfuscator">.nosp@m.</span>ho@el<span class="obfuscator">.nosp@m.</span>dora<span class="obfuscator">.nosp@m.</span>do.or<span class="obfuscator">.nosp@m.</span>g.br</a>) </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
